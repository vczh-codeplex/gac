<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=8" />
<link rel="shortcut icon" href="../../favicon.ico"/>
<link rel="Stylesheet" type="text/css" href="../../PageStyle.css" />
<title>GacLib - Demos - Controls.ListBox.VirtualMode</title>
</head>
<body>
<table class="ContainerTable">
    <tr>
        <td align="center" valign="top">
            <table class="NavigateTable" cellpadding="0" cellspacing="4" >
                <tr>
                    <td class="NavigateHeader" colspan="6" align="left">
                        <img src="../../GacLib_LogoAndTitle.gif" alt="GacLib -- GPU Accelerated C++ User Interface"/>
                    </td>
                </tr>
                <tr>
                    <td align="center" valign="middle">
                        <a class="MenuButton HomeButton" href="../../index.html">
                            HOME
                        </a>
                    </td>
                    <td align="center" valign="middle">
                        <a class="MenuButton GettingStartButton" href="../../GettingStart.html">
                            GETTING START
                        </a>
                    </td>
                    <td align="center" valign="middle">
                        <a class="MenuButton DemosButtonSelected" href="../../Demos.html">
                            DEMOS
                        </a>
                    </td>
                    <td align="center" valign="middle">
                        <a class="MenuButton DownloadButton" href="../../Download.html">
                            DOWNLOAD
                        </a>
                    </td>
                    <td align="center" valign="middle">
                        <a class="MenuButton DocumentButton" href="../../StaticHtmlDoc/reference_gacui.html">
                            DOCUMENT
                        </a>
                    </td>
                    <td align="center" valign="middle">
                        <a class="MenuButton ContactButton" href="../../Contact.html">
                            CONTACT
                        </a>
                    </td>
                </tr>
                <tr>
                    <td align="left" valign="top" colspan="6">
                        <h1>ListBox.VirtualMode</h1>
                        <img src="DXGUI_40.jpg" />
                        <pre class="CppCode">
#include "..\..\Public\Source\GacUIIncludes.h"
#include &lt;Windows.h&gt;

// for SortedList, CopyFrom and Select
using namespace vl::collections;

int CALLBACK WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int CmdShow)
{
	return SetupWindowsDirect2DRenderer();
}

/***********************************************************************
DataSource
***********************************************************************/

class <strong class="ImportantCppCode">DataSource</strong> : public <strong>list::ItemProviderBase</strong>, private <strong>list::TextItemStyleProvider::ITextItemView</strong>
{
protected:
	int				count;
public:
	DataSource()
		:count(100000)
	{
	}

	void SetCount(int newCount)
	{
		if(0<=newCount)
		{
			int oldCount=count;
			count=newCount;
				
			// this->InvokeOnItemModified(affected-items-start, affected-items-count, new-items-count);
			// this function notifies the list control to update it's content and scroll bars
			if(oldCount&lt;newCount)
			{
				// insert
				this->InvokeOnItemModified(oldCount, 0, newCount-oldCount);
			}
			else if(oldCount>newCount)
			{
				// delete
				this->InvokeOnItemModified(newCount, oldCount-newCount, 0);
			}
		}
	}

	// GuiListControl::IItemProvider
<strong>
	int Count()
	{
		return count;
	}

	IDescriptable* RequestView(const WString& identifier)
	{
		if(identifier==list::TextItemStyleProvider::ITextItemView::Identifier)
		{
			return this;
		}
		else if(identifier==GuiListControl::IItemPrimaryTextView::Identifier)
		{
			return this;
		}
		else
		{
			return 0;
		}
	}

	void ReleaseView(IDescriptable* view)
	{
	}
</strong>
	// list::TextItemStyleProvider::ITextItemView

	WString GetText(int itemIndex)
	{
		<strong>return L"Item "+itow(itemIndex+1);</strong>
	}

	bool GetChecked(int itemIndex)
	{
		// DataSource don't support check state
		return false;
	}

	void SetCheckedSilently(int itemIndex, bool value)
	{
		// DataSource don't support check state
	}

	// GuiListControl::IItemPrimaryTextView

	WString GetPrimaryTextViewText(int itemIndex)
	{
		return GetText(itemIndex+1);
	}

	bool ContainsPrimaryText(int itemIndex)
	{
		return true;
	}
};

/***********************************************************************
VirtualModeWindow
***********************************************************************/

class VirtualModeWindow : public GuiWindow
{
private:
private:
	GuiVirtualTextList*					listBox;
	GuiButton*							buttonIncrease;
	GuiButton*							buttonDecrease;
	DataSource*							dataSource;
<strong>
	void buttonIncrease_Clicked(GuiGraphicsComposition* sender, GuiEventArgs& arguments)
	{
		dataSource->SetCount(dataSource->Count()+100000);
	}

	void buttonDecrease_Clicked(GuiGraphicsComposition* sender, GuiEventArgs& arguments)
	{
		dataSource->SetCount(dataSource->Count()-100000);
	}
</strong>
public:
	VirtualModeWindow()
		:GuiWindow(GetCurrentTheme()->CreateWindowStyle())
	{
		this->SetText(L"Controls.ListBox.VirtualMode");

		GuiTableComposition* table=new GuiTableComposition;
		table->SetRowsAndColumns(3, 2);
		table->SetCellPadding(3);
		table->SetAlignmentToParent(Margin(0, 0, 0, 0));

		table->SetRowOption(0, GuiCellOption::MinSizeOption());
		table->SetRowOption(1, GuiCellOption::MinSizeOption());
		table->SetRowOption(2, GuiCellOption::PercentageOption(1.0));

		table->SetColumnOption(0, GuiCellOption::PercentageOption(1.0));
		table->SetColumnOption(1, GuiCellOption::MinSizeOption());

		this->GetContainerComposition()->AddChild(table);
		
		{
			GuiCellComposition* cell=new GuiCellComposition;
			table->AddChild(cell);
			cell->SetSite(0, 0, 3, 1);

			<strong class="ImportantCppCode">dataSource=new DataSource;</strong>
			listBox=new GuiVirtualTextList(GetCurrentTheme()->CreateTextListStyle(), GetCurrentTheme()->CreateTextListItemStyle(), <strong class="ImportantCppCode">dataSource</strong>);
			listBox->GetBoundsComposition()->SetAlignmentToParent(Margin(0, 0, 0, 0));
			listBox->SetHorizontalAlwaysVisible(false);
			cell->AddChild(listBox->GetBoundsComposition());
		}
		{
			GuiCellComposition* cell=new GuiCellComposition;
			table->AddChild(cell);
			cell->SetSite(0, 1, 1, 1);

			buttonIncrease=g::NewButton();
			buttonIncrease->SetText(L"Increase 100000 Items");
			buttonIncrease->GetBoundsComposition()->SetAlignmentToParent(Margin(0, 0, 0, 0));
			<strong>buttonIncrease->Clicked.AttachMethod(this, &VirtualModeWindow::buttonIncrease_Clicked);</strong>
			cell->AddChild(buttonIncrease->GetBoundsComposition());
		}
		{
			GuiCellComposition* cell=new GuiCellComposition;
			table->AddChild(cell);
			cell->SetSite(1, 1, 1, 1);

			buttonDecrease=g::NewButton();
			buttonDecrease->SetText(L"Decrease 100000 Items");
			buttonDecrease->GetBoundsComposition()->SetAlignmentToParent(Margin(0, 0, 0, 0));
			<strong>buttonDecrease->Clicked.AttachMethod(this, &VirtualModeWindow::buttonDecrease_Clicked);</strong>
			cell->AddChild(buttonDecrease->GetBoundsComposition());
		}

		// set the preferred minimum client size
		this->GetBoundsComposition()->SetPreferredMinSize(Size(480, 480));
		// call this to calculate the size immediately if any indirect content in the table changes
		// so that the window can calcaulte its correct size before calling the MoveToScreenCenter()
		this->ForceCalculateSizeImmediately();
		// move to the screen center
		this->MoveToScreenCenter();
	}
};

void GuiMain()
{
	GuiWindow* window=new VirtualModeWindow;
	GetApplication()->Run(window);
	delete window;
}
                        </pre>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
</table>
</body>
</html>